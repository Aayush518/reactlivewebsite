"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("@react-three/fiber"),t=require("lodash.omit"),n=require("lodash.pick"),u=require("react"),o=require("three"),c=require("three-stdlib");function s(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var a=s(u),i=s(o);const f=a.forwardRef((({children:u,domElement:o,onChange:s,onMouseDown:f,onMouseUp:l,onObjectChange:d,object:h,makeDefault:m,...v},E)=>{const g=["enabled","axis","mode","translationSnap","rotationSnap","scaleSnap","space","size","showX","showY","showZ"],{camera:b,...p}=v,L=n(p,g),j=t(p,g),w=r.useThree((e=>e.controls)),O=r.useThree((e=>e.gl)),T=r.useThree((e=>e.events)),y=r.useThree((e=>e.camera)),q=r.useThree((e=>e.invalidate)),D=r.useThree((e=>e.get)),C=r.useThree((e=>e.set)),R=b||y,k=o||T.connected||O.domElement,x=a.useMemo((()=>new c.TransformControls(R,k)),[R,k]),M=a.useRef();a.useLayoutEffect((()=>(h?x.attach(h instanceof i.Object3D?h:h.current):M.current instanceof i.Object3D&&x.attach(M.current),()=>{x.detach()})),[h,u,x]),a.useEffect((()=>{if(w){const e=e=>w.enabled=!e.value;return x.addEventListener("dragging-changed",e),()=>x.removeEventListener("dragging-changed",e)}}),[x,w]);const S=a.useRef(),U=a.useRef(),z=a.useRef(),P=a.useRef();return a.useLayoutEffect((()=>{S.current=s}),[s]),a.useLayoutEffect((()=>{U.current=f}),[f]),a.useLayoutEffect((()=>{z.current=l}),[l]),a.useLayoutEffect((()=>{P.current=d}),[d]),a.useEffect((()=>{const e=e=>{q(),null==S.current||S.current(e)},r=e=>null==U.current?void 0:U.current(e),t=e=>null==z.current?void 0:z.current(e),n=e=>null==P.current?void 0:P.current(e);return x.addEventListener("change",e),x.addEventListener("mouseDown",r),x.addEventListener("mouseUp",t),x.addEventListener("objectChange",n),()=>{x.removeEventListener("change",e),x.removeEventListener("mouseDown",r),x.removeEventListener("mouseUp",t),x.removeEventListener("objectChange",n)}}),[q,x]),a.useEffect((()=>{if(m){const e=D().controls;return C({controls:x}),()=>C({controls:e})}}),[m,x]),x?a.createElement(a.Fragment,null,a.createElement("primitive",e({ref:E,object:x},L)),a.createElement("group",e({ref:M},j),u)):null}));exports.TransformControls=f;
