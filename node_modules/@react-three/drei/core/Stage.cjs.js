"use strict";var e=require("@babel/runtime/helpers/extends"),t=require("react"),i=require("./Environment.cjs.js"),n=require("./ContactShadows.cjs.js"),r=require("./Center.cjs.js"),a=require("./AccumulativeShadows.cjs.js"),s=require("./Bounds.cjs.js");function l(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}require("@react-three/fiber"),require("three"),require("three-stdlib"),require("./useEnvironment.cjs.js"),require("../helpers/environment-assets.cjs.js"),require("./shaderMaterial.cjs.js"),require("../materials/DiscardMaterial.cjs.js");var o=l(t);const u={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function c({radius:e,adjustCamera:t}){const i=s.useBounds();return o.useEffect((()=>{t&&i.refresh().clip().fit()}),[e,t]),null}exports.Stage=function({children:t,center:l,adjustCamera:d=!0,intensity:m=.5,shadows:h="contact",environment:p="city",preset:f="rembrandt",...v}){var j,b,g,E,y,q,w,C;const S="string"==typeof f?u[f]:f,[{radius:z,height:O},B]=o.useState({radius:0,width:0,height:0,depth:0}),L=null!==(j=null==h?void 0:h.bias)&&void 0!==j?j:-1e-4,M=null!==(b=null==h?void 0:h.normalBias)&&void 0!==b?b:0,k=null!==(g=null==h?void 0:h.size)&&void 0!==g?g:1024,x=null!==(E=null==h?void 0:h.offset)&&void 0!==E?E:0,A="contact"===h||"contact"===(null==h?void 0:h.type),D="accumulative"===h||"accumulative"===(null==h?void 0:h.type),P={..."object"==typeof h?h:{}},F=p?"string"==typeof p?{preset:p}:p:null,N=o.useCallback((e=>{const{width:t,height:i,depth:n,boundingSphere:r}=e;B({radius:r.radius,width:t,height:i,depth:n}),null!=l&&l.onCentered&&l.onCentered(e)}),[]);return o.createElement(o.Fragment,null,o.createElement("ambientLight",{intensity:m/3}),o.createElement("spotLight",{penumbra:1,position:[S.main[0]*z,S.main[1]*z,S.main[2]*z],intensity:2*m,castShadow:!!h,"shadow-bias":L,"shadow-normalBias":M,"shadow-mapSize":k}),o.createElement("pointLight",{position:[S.fill[0]*z,S.fill[1]*z,S.fill[2]*z],intensity:m}),o.createElement(s.Bounds,e({fit:!!d,clip:!!d,margin:Number(d),observe:!0},v),o.createElement(c,{radius:z,adjustCamera:d}),o.createElement(r.Center,e({},l,{position:[0,x/2,0],onCentered:N}),t)),o.createElement("group",{position:[0,-O/2-x/2,0]},A&&o.createElement(n.ContactShadows,e({scale:4*z,far:z,blur:2},P)),D&&o.createElement(a.AccumulativeShadows,e({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:4*z},P),o.createElement(a.RandomizedLight,{amount:null!==(y=P.amount)&&void 0!==y?y:8,radius:null!==(q=P.radius)&&void 0!==q?q:z,ambient:null!==(w=P.ambient)&&void 0!==w?w:.5,intensity:null!==(C=P.intensity)&&void 0!==C?C:1,position:[S.main[0]*z,S.main[1]*z,S.main[2]*z],size:4*z,bias:-L,mapSize:k}))),p&&o.createElement(i.Environment,F))};
