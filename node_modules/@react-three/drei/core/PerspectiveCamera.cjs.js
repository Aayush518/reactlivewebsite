"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("react"),t=require("@react-three/fiber"),u=require("react-merge-refs"),n=require("./useFBO.cjs.js");function c(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var u=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,u.get?u:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}require("three");var a=c(r);const s=a.forwardRef((({envMap:r,resolution:c=256,frames:s=1/0,makeDefault:i,children:l,...f},o)=>{const m=t.useThree((({set:e})=>e)),g=t.useThree((({camera:e})=>e)),b=t.useThree((({size:e})=>e)),d=a.useRef(null),p=a.useRef(null),h=n.useFBO(c);a.useLayoutEffect((()=>{f.manual||(d.current.aspect=b.width/b.height)}),[b,f]),a.useLayoutEffect((()=>{d.current.updateProjectionMatrix()}));let v=0,j=null;const O="function"==typeof l;return t.useFrame((e=>{O&&(s===1/0||v<s)&&(p.current.visible=!1,e.gl.setRenderTarget(h),j=e.scene.background,r&&(e.scene.background=r),e.gl.render(e.scene,d.current),e.scene.background=j,e.gl.setRenderTarget(null),p.current.visible=!0,v++)})),a.useLayoutEffect((()=>{if(i){const e=g;return m((()=>({camera:d.current}))),()=>m((()=>({camera:e})))}}),[d,i,m]),a.createElement(a.Fragment,null,a.createElement("perspectiveCamera",e({ref:u([d,o])},f),!O&&l),a.createElement("group",{ref:p},O&&l(h.texture)))}));exports.PerspectiveCamera=s;
