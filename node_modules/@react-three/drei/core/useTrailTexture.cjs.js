"use strict";var t=require("react"),i=require("@react-three/fiber"),e=require("three");const s=t=>Math.sqrt(1-Math.pow(t-1,2));class a{constructor({size:t=256,maxAge:i=750,radius:e=.3,intensity:a=.2,interpolate:h=0,smoothing:r=0,minForce:c=.3,blend:n="screen",ease:o=s}={}){this.size=t,this.maxAge=i,this.radius=e,this.intensity=a,this.ease=o,this.interpolate=h,this.smoothing=r,this.minForce=c,this.blend=n,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new e.Texture(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(t){this.clear(),this.trail.forEach(((i,e)=>{i.age+=1e3*t,i.age>this.maxAge&&this.trail.splice(e,1)})),this.trail.length||(this.force=0),this.trail.forEach((t=>{this.drawTouch(t)})),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(t){const i=this.trail[this.trail.length-1];if(i){const e=i.x-t.x,s=i.y-t.y,a=e*e+s*s,h=Math.max(this.minForce,Math.min(1e4*a,1));if(this.force=function(t,i,e=.9){return i*e+t*(1-e)}(h,this.force,this.smoothing),this.interpolate){const t=Math.ceil(a/Math.pow(.5*this.radius/this.interpolate,2));if(t>1)for(let a=1;a<t;a++)this.trail.push({x:i.x-e/t*a,y:i.y-s/t*a,age:0,force:h})}}this.trail.push({x:t.x,y:t.y,age:0,force:this.force})}drawTouch(t){const i={x:t.x*this.size,y:(1-t.y)*this.size};let e=1;e=t.age<.3*this.maxAge?this.ease(t.age/(.3*this.maxAge)):this.ease(1-(t.age-.3*this.maxAge)/(.7*this.maxAge)),e*=t.force,this.ctx.globalCompositeOperation=this.blend;const s=this.size*this.radius*e,a=this.ctx.createRadialGradient(i.x,i.y,Math.max(0,.25*s),i.x,i.y,Math.max(0,s));a.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),a.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=a,this.ctx.arc(i.x,i.y,Math.max(0,s),0,2*Math.PI),this.ctx.fill()}}exports.useTrailTexture=function(e={}){const{size:s,maxAge:h,radius:r,intensity:c,interpolate:n,smoothing:o,minForce:l,blend:x,ease:u}=e,d=t.useMemo((()=>new a(e)),[s,h,r,c,n,o,l,x,u]);i.useFrame(((t,i)=>{d.update(i)}));const g=t.useCallback((t=>d.addTouch(t.uv)),[d]);return[d.texture,g]};
